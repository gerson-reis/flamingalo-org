---
import Layout from '../../layouts/Layout.astro';
import { Header, Footer, Menu } from '../../components/2026';
import { LanguageSwitcher } from '../../components/LanguageSwitcher';
import { getCollection, type CollectionEntry } from 'astro:content';

export async function getStaticPaths() {
  const posts = await getCollection('blog', ({ data }) => data.lang === 'en');
  return posts.map(post => {
    return {
      params: { slug: post.slug },
      props: { post },
    };
  });
}

interface Props {
  post: CollectionEntry<'blog'>;
}

const { post } = Astro.props;
const { Content } = await post.render();

const formattedDate = post.data.date.toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'long',
  day: 'numeric',
});
---

<Layout title={`${post.data.title} - Flamingalo Blog`}>
  <a class="skip-link" href="#content">Skip to content</a>
  
  <LanguageSwitcher client:load currentLang="en" />
  <Header client:load lang="en" />
  <Menu client:load lang="en" />
  
  <main id="content" class="blog-post-page">
    <article class="blog-post">
      <header class="blog-post-header">
        {post.data.image && (
          <div class="blog-post-featured-image">
            <img src={post.data.image} alt={post.data.title} />
          </div>
        )}
        
        <div class="blog-post-header-content">
          <div class="blog-post-meta">
            <div class="blog-post-author-info">
              {post.data.authorImage && (
                <img 
                  src={post.data.authorImage} 
                  alt={post.data.author}
                  class="blog-post-author-avatar"
                />
              )}
              <div>
                <span class="blog-post-author-name">{post.data.author}</span>
                <time class="blog-post-date" datetime={post.data.date.toISOString()}>
                  {formattedDate}
                </time>
              </div>
            </div>
            
            {post.data.categories && post.data.categories.length > 0 && (
              <div class="blog-post-categories">
                {post.data.categories.map((category) => (
                  <span class="blog-post-category-tag">#{category}</span>
                ))}
              </div>
            )}
          </div>
          
          <h1 class="blog-post-title">{post.data.title}</h1>
          
          {post.data.excerpt && (
            <p class="blog-post-excerpt">{post.data.excerpt}</p>
          )}
        </div>
      </header>
      
      <div class="blog-post-content">
        <Content />
      </div>
      
      <footer class="blog-post-footer">
        <a href="/blog" class="blog-post-back-link">
          ‚Üê Back to all posts
        </a>
      </footer>
    </article>
  </main>
  
  <Footer client:load lang="en" />
</Layout>

